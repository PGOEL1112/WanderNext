<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title><%= typeof title !== 'undefined' ? title + ' â€¢ ' : '' %>WanderNext</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">

  <!-- Flatpickr (optional) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

  <style>
   html, body{
  height: 100%;
  margin: 0;
  overflow-y: auto;   /* ONLY body scroll */
}

main.site-main{
  overflow-y: visible;
  height: auto !important;
}

body{
  position: relative;
  width: 100%;
  overscroll-behavior-y: contain;
  overflow-x: hidden;
}


.row{
  margin-left:0 !important;
  margin-right:0 !important;
}
*{
  box-sizing:border-box;
}

  /* ========================
     THEME VARIABLES & BASE
     ======================== */
  :root{
    /* LIGHT BODY */
    --bg: #f4f5f7;
    --card: #ffffff;
    --text: #1a1f29;
    --muted: #6b7280;

    /* DARK NAVBAR / FOOTER */
    --panel: #121319;
    --panel-text: #e6eef8;
    --panel-muted: #9aa0ad;

    /* ACCENTS */
    --accent: #6C63FF;
    --accent-2: #00E1FF;
    --accent-3: #4f46e5;

    --radius: 12px;
    --shadow: 0 10px 30px rgba(0,0,0,0.12);
    --glass: rgba(255,255,255,0.06);

    --transition-fast: 160ms;
    --transition-medium: 280ms;
  }

  html,body{height:100%;}
  body{
    margin:0;
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:var(--bg);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    line-height:1.45;
  }
  a{ color:inherit; text-decoration:none; }
  /* small utility */
  .icon-left { margin-right:8px; opacity:.92; }
  .muted { color:var(--muted); }

  /* =====================
     NAVBAR (DARK) - LAYOUT
     ===================== */
  
  .brand { display:flex; align-items:center; gap:12px; }
  .logo-mark{
    width:44px; height:44px; border-radius:10px;
    display:flex; align-items:center; justify-content:center;
    font-weight:800; color:#fff; font-size:18px;
    background: linear-gradient(135deg,var(--accent),var(--accent-3));
    box-shadow: 0 10px 30px rgba(108,99,255,0.08);
  }
  .brand .title{ font-weight:800; color:var(--panel-text); font-size:16px; }
  .brand .tag{ font-size:12px; color:var(--panel-muted); margin-top:2px; }

  /* =====================
     CENTERED SEARCH (PRIMARY)
     ===================== */
  /* main centered search: long pill */
  .search-box {
    display:flex; align-items:center; gap:8px;
    width:100%; max-width:820px;
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.06);
    padding:10px 12px;
    border-radius:999px;
    box-shadow: 0 6px 20px rgba(2,6,23,0.45);
    transition: box-shadow var(--transition-medium), transform var(--transition-medium);
  }
  .search-box:focus-within{
    box-shadow: 0 12px 40px rgba(108,99,255,0.12);
    transform: translateY(-2px);
  }

  .search-box .fa-magnifying-glass{
    font-size:18px; color:var(--panel-muted); margin-left:6px;
  }
  .search-box input[type="search"],
  .search-box input[type="text"]{
    background:transparent;
    border: none;
    outline: none;
    color:var(--panel-text);
    font-size:15px;
    padding:8px 6px;
    width:100%;
  }
  .search-box button[type="submit"]{
    background: linear-gradient(90deg,var(--accent),var(--accent-3));
    color:white;
    border:none;
    padding:8px 14px;
    border-radius:999px;
    font-weight:700;
    box-shadow: 0 10px 30px rgba(108,99,255,0.12);
    transition: transform var(--transition-fast), opacity var(--transition-fast);
  }
  .search-box button[type="submit"]:hover{ transform: translateY(-2px); opacity:.98; }

  /* Placeholder lighter */
  ::placeholder { color: rgba(230,238,248,0.5); }

  /* =====================
     RIGHT ACTIONS (NOTIF, LINKS, USER)
     ===================== */
 .actions{
  display:flex !important;
  flex-wrap:nowrap !important;
  min-width:100%;
  overflow-x:auto !important;
  overflow-y:hidden !important;
  gap:10px;
}

.actions::-webkit-scrollbar{
  display:none;
}

.actions > *{
  flex:0 0 auto;
}

.actions > a,
.actions > button{
  white-space:nowrap;
}

  .hamburger-btn{
    display:none; border:none; background:transparent; color:var(--panel-text);
    font-size:18px; padding:6px; border-radius:8px;
  }
  .hamburger-btn:hover{ background: rgba(255,255,255,0.02); }

  .btn-ghost{
    background: transparent !important;
    border:1px solid rgba(255,255,255,0.06) !important;
    color: var(--panel-text) !important;;
    padding:8px 12px !important;
    border-radius:999px !important;
    display:inline-flex !important; align-items:center !important; gap:8px !important;
    transition: background var(--transition-fast) transform var(--transition-fast) !important;
  }
  .btn-ghost:hover{ background: rgba(255,255,255,0.03) !important; transform: translateY(-2px) !important; }

  .btn-accent{
    background: linear-gradient(90deg,var(--accent),var(--accent-3)) !important;
    color:white !important; border: none !important;; padding:8px 12px !important; border-radius:999px !important; font-weight:700 !important;
    display:inline-flex !important; align-items:center !important; gap:8px !important;
    box-shadow: 0 10px 30px rgba(108,99,255,0.12) !important;
    transition: transform var(--transition-fast) !important;
  }
  .btn-accent:hover{ transform: translateY(-2px) !important; }

  /* ===== Notification bell ===== */
  .notify-btn{
    position:relative;
    display:inline-flex; align-items:center; justify-content:center;
    padding:8px; border-radius:10px; background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.04); color:var(--panel-text);
    transition: transform var(--transition-fast), box-shadow var(--transition-fast);
  }
  .notify-btn:hover{ transform: translateY(-2px); box-shadow: 0 10px 28px rgba(0,0,0,0.18); }

  .notify-badge{
    position:absolute; top:-6px; right:-6px;
    font-size:11px; padding:4px 7px; border-radius:999px;
    background: linear-gradient(90deg,var(--accent-2),#33f0ff); color:#021017; font-weight:800;
    box-shadow: 0 6px 20px rgba(0,225,255,0.08);
    transform-origin:center;
    animation: badge-pop 420ms cubic-bezier(.2,1.1,.2,1) 1;
  }
  @keyframes badge-pop{
    0%{ transform: scale(.6); opacity:0; }
    60%{ transform: scale(1.08); opacity:1; }
    100%{ transform: scale(1); }
  }

  /* Notifications dropdown (dark) */
  .notifications-menu{
    min-width:320px; max-height:420px; overflow:auto;
    background: linear-gradient(180deg, #111316, #0c0d11);
    border:1px solid rgba(255,255,255,0.04);
    box-shadow: 0 14px 40px rgba(2,6,23,0.7);
    padding:8px; border-radius:12px;
  }
  .notification-item{
    display:flex; gap:10px; align-items:flex-start; padding:10px; border-bottom:1px solid rgba(255,255,255,0.03);
  }
  .notification-item:last-child{ border-bottom:none; }
  .notification-message{ color: var(--panel-text) !important;; font-weight:700; font-size:.95rem; }
  .notification-time{ font-size:.75rem; color:var(--panel-muted); margin-top:6px; }

  /* small delete button */
  .notification-item .btn-sm{ background:transparent; border:none; color:#ff6b6b; }

  /* ===== User pill ===== */
  .user-pill{
    display:flex; gap:10px; align-items:center; padding:6px 10px; border-radius:999px;
    background: rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.04);
    cursor:pointer; transition: transform var(--transition-fast);
  }
  .user-pill:hover{ transform: translateY(-2px); }
  .user-pill .avatar{
    width:36px; height:36px; border-radius:8px; display:flex; align-items:center; justify-content:center;
    background: linear-gradient(135deg,#f97316,#fb923c); color:white; font-weight:800;
  }
  .user-pill .meta .name{ font-weight:800; color:var(--panel-text); }
  .user-pill .meta .role{ font-size:12px; color:var(--panel-muted); }

  /* =====================
     FLASH / ALERTS
     ===================== */
  .flash-area { max-width:1180px; margin:10px auto; padding:0 18px; }
  .flash-success { background: linear-gradient(90deg, rgba(108,99,255,0.12), rgba(0,225,255,0.06)); color:#0b0b0b; border-left:4px solid var(--accent); }
  .flash-error { background: linear-gradient(90deg, rgba(255,69,96,0.06), rgba(108,99,255,0.02)); color:#0b0b0b; border-left:4px solid #ff516e; }

  /* =====================
     MAIN CONTENT & CARDS (LIGHT)
     ===================== */
  main.site-main{ max-width:1180px; margin:18px auto; padding:0 18px 80px; min-height:60vh; }
  .card, .listing-card, .support-card{
    background:var(--card); color:var(--text); border-radius:var(--radius);
    box-shadow: var(--shadow); padding:12px;
  }
  .card a { color:var(--accent); text-decoration:none; }
  .card a:hover { text-decoration:underline; }

  /* =====================
     FOOTER (DARK) - Redesigned
     ===================== */
  footer.site-footer{
    background: linear-gradient(180deg, rgba(18,19,25,0.98), rgba(12,12,14,0.98));
    color:var(--panel-muted);
    padding:36px 18px;
    border-top:1px solid rgba(255,255,255,0.04);
  }
  .footer-inner{ max-width:1180px; margin:0 auto; display:flex; gap:24px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap; }
  .footer-brand{ display:flex; gap:12px; align-items:center; }
  .footer-cols{ display:flex; gap:24px; align-items:flex-start; }
  .footer-col { min-width:160px; }
  .footer-col h6{ color:var(--panel-text); font-weight:800; margin-bottom:10px; }
  .footer-links a{ display:flex; gap:8px; align-items:center; color:var(--panel-muted); padding:6px 0; transition: color var(--transition-fast), transform var(--transition-fast); }
  .footer-links a:hover { color:var(--panel-text); transform: translateX(6px); }
  .footer-cta .btn { border-radius:10px; padding:10px 14px; }

  /* small copyright row */
  .footer-bottom{ width:100%; margin-top:18px; border-top:1px solid rgba(255,255,255,0.03); padding-top:18px; color:var(--panel-muted); display:flex; justify-content:space-between; gap:12px; align-items:center; flex-wrap:wrap; font-size:13px; }

  /* =====================
     OFFCANVAS (MOBILE)
     ===================== */
  .offcanvas-start.text-bg-dark { background:var(--panel); color:var(--panel-text); border-right:1px solid rgba(255,255,255,0.04); }
  .offcanvas .offcanvas-header { border-bottom:1px solid rgba(255,255,255,0.06); }
  .offcanvas .list-group-item{ background:transparent; color:var(--panel-text); border:none; padding:12px 8px; display:flex; justify-content:space-between; align-items:center; }
  .offcanvas .list-group-item .fa-fw { opacity:.7; }
  .offcanvas .list-group-item:hover{ background: rgba(255,255,255,0.02); color:#fff; }

  /* =====================
     DROPDOWNS (LIGHT on body)
     ===================== */
  .dropdown-menu { background:var(--card); border:1px solid rgba(0,0,0,0.08); color:var(--text); box-shadow: 0 10px 30px rgba(0,0,0,0.08); border-radius:10px; }
  .dropdown-item{ display:flex; gap:10px; align-items:center; color:var(--text); transition: background var(--transition-fast); }
  .dropdown-item:hover{ background: rgba(0,0,0,0.04); color:var(--text); }

  /* =====================
     ICON + ANCHOR HOVER GLOBAL
     ===================== */
  .with-icon { display:inline-flex; align-items:center; gap:8px; transition: transform var(--transition-fast), color var(--transition-fast); }
  .with-icon:hover{ transform: translateY(-3px); color:var(--accent-3); text-decoration:none; }

  /* =====================
     RESPONSIVE RULES
     ===================== */
  @media (max-width: 500px){
    .search-box{ max-width:520px; padding:8px; }
    .logo-mark{ width:40px; height:40px; }
  }

  /* tiny polish */
  .glow::after{
    content:"";
    position:absolute; inset:-6px;
    border-radius:12px;
    background: radial-gradient(ellipse at center, rgba(108,99,255,0.06), transparent 30%);
    z-index:-1; filter: blur(10px); opacity:.9;
  }
  
  @media (max-width: 576px){
  .notifications-menu{
    min-width:94vw !important;
    max-width:94vw !important;
    left:50% !important;
    right:auto !important;
    transform:translateX(-50%) !important;
  }

  .notification-message{
    font-size:14px;
    line-height:1.4;
  }
}

/* ===== FOOTER: DESKTOP-LIKE ON MOBILE ===== */
@media (max-width: 768px){

  .footer-inner{
    flex-direction:row;        /* ðŸ”¥ KEEP ROW */
    flex-wrap:wrap;            /* ðŸ”¥ MAGIC */
    align-items:flex-start;
    gap:20px;
  }

  .footer-brand{
    flex:1 1 220px;
  }

  .footer-cols{
    flex:2 1 420px;
    flex-direction:row;        /* ðŸ”¥ NOT COLUMN */
    flex-wrap:wrap;
    gap:20px;
  }

  .footer-col{
    min-width:140px;
  }

  .footer-cta{
    flex:1 1 200px;
  }

  .footer-bottom{
    flex-direction:row;
    flex-wrap:wrap;
    justify-content:space-between;
  }
}


.offcanvas{
  z-index:2000;
}
.offcanvas-backdrop{
  z-index:1999;
}

/* ================= HEADER LAYOUT ================= */

/* ===== FINAL HEADER LAYOUT (GRID ONLY) ===== */

.topbar{
  position:sticky;
  top:0;
  z-index:1200;
  display:grid;
  grid-template-columns:auto 1fr auto;
  align-items:center;
  gap:12px;
  padding:10px 16px;
  background: linear-gradient(180deg, rgba(18,19,25,0.98), rgba(18,19,25,0.95));
  color:var(--panel-text);
  border-bottom:1px solid rgba(255,255,255,0.04);
}

header.topbar{
  overflow: visible !important;
}

.header-left{ display:flex; align-items:center; }
.header-center{ display:flex; justify-content:center; }
.header-right{
  overflow-x:auto;
  overflow-y:hidden;
  white-space:nowrap;
  -webkit-overflow-scrolling:touch;
  touch-action: pan-x;
}

/* scrollbar hide */


.header-center .search-box{
  width:100%;
  max-width:720px;
}

/* ===== TABLET ===== */
@media (max-width: 992px){
  .topbar{
    grid-template-columns:auto auto;
  }

  .header-center{
    grid-column:1 / -1;
    margin-top:8px;
  }

  .hamburger-btn{
    display:inline-flex;
  }

  .brand .tag{
    display:none;
  }

  .search-box{
    max-width:100%;
  }

  .actions{
    overflow-x:auto;
    overflow-y:hidden;
    -webkit-overflow-scrolling:touch;
    scrollbar-width:none; /* Firefox */
  }

  .actions::-webkit-scrollbar{
    display:none; /* Chrome / Safari */
  }

  .header-right{
    max-width:100%;
  }

  .header-right::after{
    content:'â‡¢';
    position:absolute;
    right:4px;
    top:50%;
    transform:translateY(-50%);
    color:var(--panel-muted);
    opacity:.6;
    pointer-events:none;
  }
}


/* ===== MOBILE ===== */
@media (max-width: 768px){
  .topbar{
    grid-template-columns:1fr auto;
  }

  .header-center{
    grid-column:1 / -1;
  }

  .user-pill{
    padding:6px;
    gap:0;
    min-height:44px;
  }

  .user-pill .meta{
    display:none;
  }

  .user-pill .avatar{
    width:38px;
    height:38px;
    font-size:16px;
  }
}

/* ===== USER DROPDOWN MOBILE FIX ===== */
@media (max-width: 576px){
  .dropdown-menu{
    position: fixed !important;
    top: 72px !important;   /* header ke neeche */
    left: 50% !important;
    right: auto !important;
    transform: translateX(-50%) !important;
    min-width: 92vw !important;
    max-width: 92vw !important;
  }
  
}

/* ===== FIX: DESKTOP NOTIFICATION CLIPPING ===== */
.topbar,
.dropdown {
  overflow: visible !important;
}

/* Notifications dropdown proper layering */
.notifications-menu{
  position: absolute !important;
  top: calc(100% + 12px);
  right: 0;
  z-index: 9999;
}

.user-dropdown-menu{
  min-width: 240px;
}

.user-dropdown-menu .dropdown-item{
  padding:10px 14px;
  font-weight:600;
}

/* ===== FIX: RESPONSIVE NOTIFICATION MESSAGE ===== */
.notification-message{
  color: var(--panel-text) !important;   /* readable on dark bg */
  font-weight:600;
  font-size:14px;
  line-height:1.45;
  word-break: break-word;
  white-space: normal;
}

.notification-item a{
  display:block;
}

@media (max-width: 576px){
  .notification-message{
    font-size:13.5px;
    line-height:1.5;
    color: black !important;
  }
  .notifications-menu{
    position: fixed !important;
    bottom: 0;
    top: auto !important;
    left: 12rem !important;
    right: 0 !important;
    width: 100vw !important;
    max-height: 60vh;
    border-radius: 16px 16px 0 0;
  }
}

/* ===== MOBILE NOTIFICATION LAYOUT FIX ===== */
@media (max-width: 576px){

  .notification-item{
    flex-direction: column;
    align-items: flex-start;
    gap:6px;
  }

  .notification-item > div:last-child{
    align-self: flex-end; /* delete button right side */
  }

  .notification-time{
    margin-top:4px;
  }
}

/* ===== DESKTOP NOTIFICATION FIX ===== */
@media (min-width: 992px){
  .notifications-menu{
    position: fixed !important;
    top: 72px !important;              /* header ke neeche */
    right: 24px !important;            /* bell ke paas */
    left: auto !important;
    transform: none !important;
    z-index: 99999 !important;
  }

  .user-dropdown-menu{
    position: absolute !important;
    top: calc(100% + 10px) !important;
    right: 0 !important;
    left: auto !important;
    transform: none !important;
    z-index: 99999 !important;
  }
}

/* ===== DESKTOP USER DROPDOWN VISIBILITY FIX ===== */
/* ===== DESKTOP USER DROPDOWN â€“ FINAL FIX ===== */
@media (min-width: 992px){
  .header-right,
  .actions{
    overflow: visible !important;
  }
}



  </style>
</head>
<body>

  <!-- NAVBAR -->
  <header class="topbar">
   <div class="header-left">
      <a href="/listings" class="brand">
        <div class="logo-mark"><i class="fa-solid fa-compass"></i></div>
        <div class="brand-text">
          <div class="title">WanderNext</div>
          <div class="tag">discover your next stay</div>
        </div>
      </a>
  </div>

    <!-- centered search -->
     <div class="header-center">
        <form id="globalSearchForm" action="/listings" method="GET" class="search-box" aria-label="Global search">
          <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i>
          <!-- dynamic search value preserved -->
          <input name="search" id="globalSearch" type="search" value="<%= typeof search !== 'undefined' ? search : '' %>" placeholder="ðŸ” Search stays, placesâ€¦" autocomplete="off" />
          <button type="submit" title="Search" aria-label="Search">Search</button>
        </form>
      </div>

    <!-- right actions -->
     <div class="header-right">
    <div class="actions d-flex align-items-center gap-2">

      <!-- Mobile hamburger (visible on small screens) -->
      <button class="hamburger-btn d-inline d-lg-none me-1" id="hamburgerToggle" aria-label="Open menu">
        <i class="fa-solid fa-bars"></i>
      </button>

      <% if (currentUser) { %>
        <!-- notifications -->
        <div class="dropdown">
          <button id="notifyToggle" class="notify-btn" data-bs-toggle="dropdown" aria-expanded="false" title="Notifications" aria-haspopup="true">
            <i class="fa-solid fa-bell"></i>
            <% if (typeof unreadCount !== 'undefined' && unreadCount > 0) { %>
              <span class="notify-badge"><%= unreadCount %></span>
            <% } %>
          </button>

          <ul class="dropdown-menu dropdown-menu-end notifications-menu" aria-labelledby="notifyToggle">
            <% if (!notifications || notifications.length === 0) { %>
              <li class="text-center small p-3" style="color:var(--panel-muted)"><i class="fa-regular fa-bell-slash me-2"></i> No notifications</li>
            <% } else { %>
              <% notifications.forEach(n => { %>
                <li class="notification-item" id="notif-<%= n._id %>">
                  <div style="flex:1">
                    <a href="<%= n.link || '#' %>" class="text-decoration-none">
                      <div class="notification-message"><i class="fa-solid fa-circle-exclamation icon-left"></i><%= n.message %></div>
                      <div class="notification-time"><i class="fa-regular fa-clock me-1"></i><%= new Date(n.createdAt).toLocaleString("en-IN") %></div>
                    </a>
                  </div>
                  <div>
                    <button class="btn btn-sm" style="background:transparent;border:none;color:#ff6b6b" data-id="<%= n._id %>" aria-label="delete-notif">
                      <i class="fa-solid fa-trash"></i>
                    </button>
                  </div>
                </li>
              <% }) %>
            <% } %>
          </ul>
        </div>
      <% } else { %>
        <div style="width:44px"></div>
      <% } %>

      <!-- Home link (large screens) -->
      <a href="/" class="btn btn-ghost d-none d-lg-inline with-icon"><i class="fa-solid fa-house icon-left"></i>Home</a>

      <% if (!currentUser) { %>
        <a href="/login" class="btn btn-accent with-icon"><i class="fa-solid fa-right-to-bracket icon-left"></i>Login</a>
        <a href="/register" class="btn btn-ghost with-icon"><i class="fa-solid fa-user-plus icon-left"></i>Register</a>
      <% } else { %>
        <a href="/listings" class="btn btn-ghost d-none d-lg-inline with-icon"><i class="fa-solid fa-map-marker-alt icon-left"></i>Listings</a>

        <% if (currentUser.role === 'user') { %>
          <a href="/become-owner" class="btn btn-ghost d-none d-lg-inline with-icon"><i class="fa-solid fa-store icon-left"></i>Become Owner</a>
          <a href="/saved" class="btn btn-ghost d-none d-lg-inline with-icon"><i class="fa-solid fa-heart icon-left"></i>Wishlist</a>
        <% } %>

        <!-- user dropdown -->
        <div class="dropdown">
          <button class="user-pill" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" title="Open account menu">
            <div class="avatar"><%= currentUser.username ? currentUser.username.charAt(0).toUpperCase() : 'U' %></div>
            <div class="meta">
              <div class="name"><%= currentUser.username %></div>
              <div class="role"><%= currentUser.role %></div>
            </div>
          </button>

          <ul class="dropdown-menu dropdown-menu-end user-dropdown-menu">
  
  <% if (currentUser.role === 'admin') { %>
    <li>
      <a class="dropdown-item" href="/admin/dashboard">
        <i class="fa-solid fa-shield-halved"></i> Admin Dashboard
      </a>
    </li>
  <% } else { %>
    <li>
      <a class="dropdown-item" href="/dashboard/<%= currentUser.role %>">
        <i class="fa-solid fa-chart-line"></i> Dashboard
      </a>
    </li>
  <% } %>

  <li>
    <a class="dropdown-item" href="/profile">
      <i class="fa-solid fa-user"></i> Profile
    </a>
  </li>

  <% if (currentUser.role === 'user') { %>
    <li>
      <a class="dropdown-item" href="/saved">
        <i class="fa-solid fa-heart"></i> Wishlist
      </a>
    </li>
  <% } %>

  <li><hr class="dropdown-divider"></li>

  <li>
    <a class="dropdown-item text-danger" data-bs-toggle="modal" data-bs-target="#logoutModal">
      <i class="fa-solid fa-right-from-bracket"></i> Logout
    </a>
  </li>
</ul>

        </div>
      <% } %>
    </div>
    </div>
  </header>

  <!-- MOBILE OFFCANVAS PANEL -->
  <div class="offcanvas offcanvas-start text-bg-dark" tabindex="-1" id="mobileOffcanvas" aria-labelledby="mobileOffcanvasLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="mobileOffcanvasLabel">
        <span class="d-flex align-items-center gap-2">
          <span class="logo-mark" style="width:36px;height:36px;font-size:14px"><i class="fa-solid fa-compass"></i></span>
          WanderNext
        </span>
      </h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>

    <div class="offcanvas-body">
      <form action="/listings" method="GET" class="mb-3">
        <div class="input-group">
          <input name="search" class="form-control" placeholder="Search stays, city, property..." value="<%= typeof search !== 'undefined' ? search : '' %>">
          <button class="btn btn-primary" type="submit"><i class="fa-solid fa-magnifying-glass"></i></button>
        </div>
      </form>

      <nav class="list-group list-group-flush">
        <a href="/listings" class="list-group-item list-group-item-action bg-transparent text-light"><i class="fa-solid fa-list me-2"></i>Listings</a>
        <a href="/listings" class="list-group-item list-group-item-action bg-transparent text-light"><i class="fa-solid fa-fire me-2"></i>Popular</a>
        <a href="/listings" class="list-group-item list-group-item-action bg-transparent text-light"><i class="fa-solid fa-tags me-2"></i>Categories</a>
        <a href="/support" class="list-group-item list-group-item-action bg-transparent text-light"><i class="fa-solid fa-headset me-2"></i>Support</a>

        <% if (!currentUser) { %>
          <a href="/login" class="list-group-item list-group-item-action bg-transparent text-light"><i class="fa-solid fa-right-to-bracket me-2"></i>Login</a>
          <a href="/register" class="list-group-item list-group-item-action bg-transparent text-light"><i class="fa-solid fa-user-plus me-2"></i>Register</a>
        <% } else { %>

          <% if (currentUser.role === 'admin') { %>
            <a href="/admin/dashboard" class="list-group-item list-group-item-action bg-transparent text-light"><i class="fa-solid fa-shield-halved me-2"></i>Admin Dashboard</a>
          <% } %>

          <a href="/dashboard/<%= currentUser.role %>" class="list-group-item list-group-item-action bg-transparent text-light"><i class="fa-solid fa-chart-line me-2"></i>Dashboard</a>
          <a href="/profile" class="list-group-item list-group-item-action bg-transparent text-light"><i class="fa-solid fa-user me-2"></i>Profile</a>
          <a href="/logout" class="list-group-item list-group-item-action bg-transparent text-danger"><i class="fa-solid fa-right-from-bracket me-2"></i>Logout</a>
        <% } %>
      </nav>
    </div>
  </div>

  <!-- FLASH AREA -->
  <div class="flash-area">
    <div class="container px-0">
      <% if (typeof success !== 'undefined' && success && success.length) { %>
        <% success.forEach(m => { %>
          <div class="alert flash-success d-flex justify-content-between align-items-center py-2 px-3 mb-2" role="alert">
            <div><i class="fa-solid fa-circle-check me-2"></i><%= m %></div>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        <% }) %>
      <% } %>

      <% if (typeof error !== 'undefined' && error && error.length) { %>
        <% error.forEach(m => { %>
          <div class="alert flash-error d-flex justify-content-between align-items-center py-2 px-3 mb-2" role="alert">
            <div><i class="fa-solid fa-triangle-exclamation me-2"></i><%= m %></div>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        <% }) %>
      <% } %>
    </div>
  </div>

  <!-- MAIN -->
  <main class="site-main">
    <%- body %>
  </main>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="footer-inner">
      <div class="footer-brand d-flex gap-3 align-items-center">
        <div class="logo-mark" style="width:48px;height:48px;font-size:19px"><i class="fa-solid fa-compass"></i></div>
        <div>
          <div style="font-weight:800; color:var(--panel-text)">WanderNext</div>
          <div style="font-size:13px; color:var(--panel-muted)">Find beautiful stays & experiences</div>
        </div>
      </div>

      <div class="footer-cols">
        <div class="footer-col">
          <h6>Product</h6>
          <div class="footer-links">
            <a href="/listings" class="with-icon"><i class="fa-solid fa-list fa-fw"></i> Listings</a>
            <a href="#" class="with-icon"><i class="fa-solid fa-fire fa-fw"></i> Popular</a>
            <a href="#" class="with-icon"><i class="fa-solid fa-tags fa-fw"></i> Categories</a>
          </div>
        </div>

        <div class="footer-col">
          <h6>Company</h6>
          <div class="footer-links">
            <a href="#" class="with-icon"><i class="fa-solid fa-info-circle fa-fw"></i> About</a>
            <a href="#" class="with-icon"><i class="fa-solid fa-briefcase fa-fw"></i> Careers</a>
            <a href="#" class="with-icon"><i class="fa-solid fa-newspaper fa-fw"></i> Press</a>
          </div>
        </div>

        <div class="footer-col">
          <h6>Support</h6>
          <div class="footer-links">
            <a href="/support" class="with-icon"><i class="fa-solid fa-headset fa-fw"></i> Support</a>
            <a href="#" class="with-icon"><i class="fa-solid fa-question-circle fa-fw"></i> Help Center</a>
            <a href="#" class="with-icon"><i class="fa-solid fa-shield-halved fa-fw"></i> Privacy</a>
          </div>
        </div>
      </div>

      <div class="d-flex gap-2 align-items-center footer-cta">
        <a href="/listings" class="btn btn-accent glow with-icon"><i class="fa-solid fa-arrow-right"></i> Explore Listings</a>
      </div>

      <div class="footer-bottom">
        <div>Â© <%= new Date().getFullYear() %> WanderNext</div>
        <div style="display:flex;gap:12px;align-items:center;">
          <a href="https://twitter.com" target="_blank" class="with-icon"><i class="fa-brands fa-twitter fa-fw"></i></a>
          <a href="https://instagram.com" target="_blank" class="with-icon"><i class="fa-brands fa-instagram fa-fw"></i></a>
          <a href="https://facebook.com" target="_blank" class="with-icon"><i class="fa-brands fa-facebook fa-fw"></i></a>
        </div>
      </div>
    </div>
  </footer>

  <!-- LOGOUT MODAL -->
  <div class="modal fade" id="logoutModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="background: linear-gradient(180deg,#0f1720,#090a0c); color:var(--panel-text); border-radius:12px;">
        <div class="modal-header border-0">
          <h5 class="modal-title"><i class="fa-solid fa-right-from-bracket me-2"></i>Confirm Logout</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">Are you sure you want to logout?</div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-ghost" data-bs-dismiss="modal">Cancel</button>
          <a href="/logout" class="btn btn-accent">Logout</a>
        </div>
      </div>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>

  <script>
  // Mobile offcanvas toggle
  const hamburger = document.getElementById('hamburgerToggle');
const offcanvasEl = document.getElementById('mobileOffcanvas');

if (hamburger && offcanvasEl) {
  const bsOffcanvas = bootstrap.Offcanvas.getOrCreateInstance(offcanvasEl);

  hamburger.addEventListener('click', () => {
    bsOffcanvas.show();
  });
}


  // Socket / Notifications + real-time join
  (function () {
    const socket = (typeof io !== 'undefined') ? io() : null;
    const CURRENT_USER_ID = <%- currentUser ? `"${currentUser._id}"` : "null" %>;

    if (socket && CURRENT_USER_ID && CURRENT_USER_ID !== "null") {
      socket.emit('joinUser', CURRENT_USER_ID);

      socket.on('newNotification', function (notif) {
        try {
          addNotificationToMenu(notif);
        } catch (e) { console.error(e); }
      });
    }

    // Add notif to dropdown menu and increment badge
    function addNotificationToMenu(notif) {
      const menu = document.querySelector('.notifications-menu');
      if (!menu) return;

      // update badge
      let badge = document.querySelector('.notify-badge');
      if (badge) {
        badge.innerText = (parseInt(badge.innerText || '0') + 1).toString();
        // small pulse
        badge.animate([{ transform: 'scale(1.12)' }, { transform: 'scale(1)' }], { duration: 360, easing: 'cubic-bezier(.2,1,.2,1)' });
      } else {
        const toggle = document.getElementById('notifyToggle') || document.getElementById('notifyBtn');
        if (toggle) {
          toggle.insertAdjacentHTML('beforeend', '<span class="notify-badge">1</span>');
        }
      }

      // create element
      const li = document.createElement('li');
      li.className = 'notification-item';
      li.id = `notif-${notif._id}`;
      li.innerHTML = '\
        <div style="flex:1">\
          <a href="' + (notif.link || '#') + '" class="text-decoration-none">\
            <div class="notification-message"><i class="fa-solid fa-circle-exclamation icon-left"></i>' + escapeHtml(notif.message) + '</div>\
            <div class="notification-time"><i class="fa-regular fa-clock me-1"></i>' + new Date(notif.createdAt).toLocaleString('en-IN') + '</div>\
          </a>\
        </div>\
        <div>\
          <button class="btn btn-sm" style="background:transparent;border:none;color:#ff6b6b" data-id="' + notif._id + '" aria-label="delete-notif"><i class="fa-solid fa-trash"></i></button>\
        </div>';
      menu.prepend(li);
    }

    // delete notification (delegated)
    document.addEventListener('click', async function (e) {
      const btn = e.target.closest('button[aria-label="delete-notif"]');
      if (!btn) return;
      const id = btn.dataset.id;
      try {
        const res = await fetch('/notifications/delete/' + id, { method: 'DELETE' });
        if (res.ok) {
          const el = document.getElementById('notif-' + id);
          if (el) el.remove();
          const badge = document.querySelector('.notify-badge');
          if (badge) {
            let v = parseInt(badge.innerText || '0') - 1;
            if (v <= 0) badge.remove();
            else badge.innerText = String(v);
          }
        } else {
          console.warn('Could not delete notification', res.status);
        }
      } catch (err) {
        console.error(err);
      }
    });

    // safe escape helper
    function escapeHtml(str) {
      if (!str) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');
    }
  })();

  // ensure global search Enter works (keeps current dynamic behaviour)
  document.getElementById('globalSearchForm')?.addEventListener('submit', function () {
    // will submit to /listings with ?search=...
  });

 document.addEventListener('hidden.bs.modal', () => {
  document.body.classList.remove('modal-open');
  document.body.style.overflow = 'auto';
  document.body.style.paddingRight = '';
});

document.addEventListener('hidden.bs.offcanvas', () => {
  document.body.classList.remove('modal-open');
  document.body.style.overflow = 'auto';
  document.body.style.paddingRight = '';
});

  // small accessibility: close dropdown if clicked outside (extra safety)
  document.addEventListener('click', function(e){
    const dropdowns = document.querySelectorAll('.dropdown.show');
    dropdowns.forEach(dd => {
      if (!dd.contains(e.target)) {
        const toggle = dd.querySelector('[data-bs-toggle="dropdown"]');
        if (toggle) {
          try { bootstrap.Dropdown.getInstance(toggle)?.hide(); } catch(e) {}
        }
      }
    });
  });
  </script>
</body>
</html>