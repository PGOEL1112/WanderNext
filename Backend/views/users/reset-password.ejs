<%- layout("layouts/boilerplate") %>

<style>
  .reset-container {
    min-height: 80vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .reset-card {
    width: 380px;
    padding: 25px;
    border-radius: 12px;
    background: #ffffff;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    animation: fadeIn 0.5s ease-in-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .reset-title {
    font-weight: 700;
    font-size: 22px;
    margin-bottom: 20px;
    text-align: center;
  }

  .password-container {
    margin-bottom: 20px;
  }

  .input-group {
    position: relative;
  }

  .input-group input {
    width: 100%;
    padding: 10px 40px 10px 12px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 14px;
  }

  .eye-icon {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    color: #666;
    font-size: 16px;
    transition: color 0.2s;
  }

  .eye-icon:hover {
    color: #000;
  }

  .strength-bar {
    height: 5px;
    width: 100%;
    border-radius: 5px;
    background: #ddd;
    margin-top: 5px;
    overflow: hidden;
  }

  .strength-fill {
    height: 100%;
    width: 0%;
    background: red;
    transition: 0.3s;
  }

  #matchText {
    font-size: 13px;
    margin-top: 5px;
  }

  button.reset-btn {
    width: 100%;
    padding: 10px;
    background: #f4a024;
    color: white;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s;
  }

  button.reset-btn:hover {
    background: #d4881c;
  }
</style>

<div class="reset-container">
  <div class="reset-card">

    <h3 class="reset-title">
      <i class="fa-solid fa-lock"></i> Reset Password
    </h3>

    <form action="/reset-password/<%= token %>" method="POST">

      <!-- New Password -->
      <div class="password-container">
        <label>New Password</label>
        <div class="input-group">
          <input type="password" id="newPassword" name="password" placeholder="Enter new password" required>
          <span class="eye-icon" id="toggleNewPassword"><i class="fa-solid fa-eye"></i></span>
        </div>
        <div class="strength-bar">
          <div class="strength-fill" id="strengthFill"></div>
        </div>
      </div>

      <!-- Confirm Password -->
      <div class="password-container">
        <label>Confirm Password</label>
        <div class="input-group">
          <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm password" required>
          <span class="eye-icon" id="toggleConfirmPassword"><i class="fa-solid fa-eye"></i></span>
        </div>
        <div id="matchText"></div>
      </div>

      <button class="reset-btn">Reset Password</button>
    </form>

  </div>
</div>

<script>
  const newPass = document.getElementById("newPassword");
  const confirmPass = document.getElementById("confirmPassword");
  const toggleNew = document.getElementById("toggleNewPassword");
  const toggleConfirm = document.getElementById("toggleConfirmPassword");
  const strengthFill = document.getElementById("strengthFill");
  const matchText = document.getElementById("matchText");

  // Toggle new password visibility
  toggleNew.addEventListener("click", () => {
    newPass.type = newPass.type === "password" ? "text" : "password";
    toggleNew.querySelector("i").classList.toggle("fa-eye-slash");
  });

  // Toggle confirm password visibility
  toggleConfirm.addEventListener("click", () => {
    confirmPass.type = confirmPass.type === "password" ? "text" : "password";
    toggleConfirm.querySelector("i").classList.toggle("fa-eye-slash");
  });

  // Password Strength Meter
  newPass.addEventListener("input", () => {
    const value = newPass.value;
    let strength = 0;
    if (value.length >= 6) strength += 1;
    if (/[A-Z]/.test(value)) strength += 1;
    if (/[0-9]/.test(value)) strength += 1;
    if (/[\W]/.test(value)) strength += 1;

    strengthFill.style.width = (strength * 25) + "%";
    strengthFill.style.background =
      strength <= 1 ? "red" :
      strength === 2 ? "orange" :
      strength === 3 ? "yellow" : "green";
  });

  // Confirm password match
  confirmPass.addEventListener("input", () => {
    matchText.innerHTML = confirmPass.value === newPass.value
      ? '<span style="color:green;">✔ Passwords match</span>'
      : '<span style="color:red;">✘ Passwords do not match</span>';
  });
</script>
