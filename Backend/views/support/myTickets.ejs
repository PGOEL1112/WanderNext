<%- layout("layouts/boilerplate") %>

<style>
.my-tickets-wrapper {
  max-width: 900px;
  margin: 35px auto;
  padding: 10px;
}

/* Header */
.page-title {
  font-size: 2.2rem;
  font-weight: 800;
  color: #0f172a;
}

.sub-text {
  color: #64748b;
  margin-bottom: 25px;
}

/* Ticket Card */
.ticket-item {
  background: #ffffff;
  padding: 22px;
  border-radius: 20px;
  border: 1px solid #e5e7eb;
  box-shadow: 0 12px 26px rgba(0,0,0,0.1);
  margin-bottom: 20px;
  transition: 0.25s;
}
.ticket-item:hover {
  transform: translateY(-6px);
  box-shadow: 0 18px 32px rgba(0,0,0,0.16);
}

.ticket-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.ticket-id {
  font-size: 1.1rem;
  font-weight: 700;
  color: #111827;
}

/* Status Badge */
.status-badge {
  padding: 6px 14px;
  border-radius: 40px;
  font-weight: 700;
  font-size: 0.75rem;
}

.status-open        { background:#fee2e2; color:#dc2626; }
.status-inprogress  { background:#fef3c7; color:#b45309; }
.status-resolved    { background:#dcfce7; color:#15803d; }
.status-closed      { background:#e5e7eb; color:#4b5563; }

/* Buttons */
.view-ticket-btn {
  background:#0f172a;
  color:white;
  padding:10px 20px;
  border-radius:12px;
  text-decoration:none;
  font-weight:700;
  transition:0.25s;
}
.view-ticket-btn:hover {
  background:#000;
}

/* Chat Button */
.chat-btn {
  background:#1d4ed8;
  color:white;
  padding:10px 18px;
  border-radius:12px;
  font-weight:700;
  text-decoration:none;
  margin-left: 10px;
}
.chat-btn:hover {
  background:#1e40af;
}

</style>

<div class="my-tickets-wrapper">

  <h2 class="page-title"><i class="fa-solid fa-life-ring me-2"></i>Your Support Tickets</h2>
  <p class="sub-text">Easily track your opened & resolved support requests.</p>

  <% if (tickets.length === 0) { %>
    <p class="text-muted text-center mt-3">No support tickets found. Need help? Create one from the Support page.</p>
  <% } %>

  <% tickets.forEach(ticket => { %>
    <div class="ticket-item">

      <!-- Header -->
      <div class="ticket-header">
        <div class="ticket-id">Ticket #<%= ticket._id %></div>

        <span class="status-badge 
          <%= ticket.status === 'open' ? 'status-open' : 
              ticket.status === 'in-progress' ? 'status-inprogress' :
              ticket.status === 'resolved' ? 'status-resolved' : 
              'status-closed' %>">
          <%= ticket.status.toUpperCase() %>
        </span>
      </div>

      <!-- Issue Details -->
      <p class="mt-2"><b>Issue Type:</b> <%= ticket.issueType %></p>
      <p><b>Your Message:</b> <%= ticket.message %></p>

      <% if (ticket.adminReply) { %>
        <p><b>Last Admin Reply:</b> <%= ticket.adminReply %></p>
      <% } %>

      <!-- Action Buttons -->
      <div class="mt-3">
        <a class="view-ticket-btn" href="/support/ticket/<%= ticket._id %>">
          View Details â†’
        </a>

        <a class="chat-btn" href="/support/ticket/<%= ticket._id %>#chat">
          ðŸ’¬ Start Chat
        </a>
      </div>

    </div>
  <% }) %>

</div>
